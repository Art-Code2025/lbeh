# دليل حل المشاكل - لبيه Dashboard

## المشاكل الشائعة وحلولها

### 1. مشكلة "No document to update" في الفئات

**المشكلة:** 
```
Error saving category: FirebaseError: No document to update: projects/lbeh-81936/databases/(default)/documents/categories/home_maintenance
```

**السبب:** 
- قاعدة البيانات تحتوي على معرفات مختلطة للفئات
- بعض الفئات لها معرفات مخصصة مثل `home_maintenance` والبعض الآخر لديه معرفات تلقائية من Firebase

**الحل:**
1. اضغط على زر "إصلاح هيكل البيانات" في الشريط الجانبي
2. أو استخدم زر "إعادة تعيين كاملة" لحل جذري

### 2. مشكلة تعديل الخدمات لا تعمل

**المشكلة:** 
- عند الضغط على "تعديل" في الخدمات لا يحدث شيء
- النافذة المنبثقة لا تظهر أو تظهر فارغة

**الحل:**
- تم إصلاح هذه المشكلة بإضافة دالة `handleServiceEdit` المناسبة
- تم تحسين `ServiceModal` لملء البيانات بشكل صحيح

### 3. مشكلة حذف الخدمات

**المشكلة:**
```
s.indexOf is not a function
```

**السبب:** 
- محاولة استخدام دوال النصوص على معرفات غير صحيحة

**الحل:**
- تم إصلاح دالة `handleServiceDelete` لاستخدام معرفات Firebase الصحيحة

### 4. مشاكل API والاتصال

**المشكلة:**
```
SyntaxError: Unexpected token '<', "<!DOCTYPE "... is not valid JSON
```

**السبب:** 
- Netlify Functions غير متاحة، يتم إرجاع HTML بدلاً من JSON

**الحل:**
- تم تحسين معالجة الأخطاء للتبديل تلقائياً إلى Firebase
- إضافة فحص محتوى الاستجابة قبل تحليل JSON

## أدوات إصلاح قاعدة البيانات

### 1. إصلاح هيكل البيانات
- يصلح معرفات الفئات ليكون لها معرفات مخصصة ثابتة
- يضمن تطابق الخدمات مع الفئات الصحيحة
- **آمن:** لا يحذف الحجوزات أو مقدمي الخدمة

### 2. إعادة تعيين كاملة
- يحذف جميع الفئات والخدمات الحالية
- ينشئ فئات وخدمات جديدة بهيكل صحيح
- **تحذير:** لا يمكن التراجع عن هذا الإجراء

### 3. فحص وإضافة البيانات
- يتحقق من وجود البيانات الأساسية
- يضيف البيانات المفقودة فقط
- **آمن:** لا يحذف أي بيانات موجودة

## نصائح للاستخدام الآمن

1. **قم بعمل نسخة احتياطية من الحجوزات المهمة قبل أي إصلاح**
2. **استخدم "إصلاح هيكل البيانات" أولاً قبل الحلول الأخرى**
3. **تجنب "إعادة تعيين كاملة" إلا في الحالات الطارئة**
4. **راقب وحدة التحكم في المتصفح للأخطاء التفصيلية**

## التحقق من نجاح الإصلاح

بعد تطبيق أي إصلاح، تأكد من:

1. ✅ يمكن إضافة فئات جديدة
2. ✅ يمكن تعديل الفئات الموجودة  
3. ✅ يمكن حذف الفئات
4. ✅ يمكن إضافة خدمات جديدة
5. ✅ يمكن تعديل الخدمات الموجودة
6. ✅ يمكن حذف الخدمات
7. ✅ تظهر أعداد الخدمات الصحيحة في كل فئة

## الاتصال بالدعم

إذا استمرت المشاكل، تحقق من:
- اتصال الإنترنت
- صلاحيات Firebase
- وحدة التحكم في المتصفح للأخطاء الجديدة 